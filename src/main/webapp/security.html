<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <title>骇客学院</title>
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="css/security.min.css">
    <script type="text/javascript" src="js/growingio.js?t=1513326254000"></script>
    <script type="text/javascript" src="js/mask.js?t=1513326254000"></script>
    <script type="text/javascript" src="js/jquery.min.js?t=1513326254000"></script>
    <script type="text/javascript" src="js/header.min.js?t=1544581681296"></script>
    <script type="text/javascript" src="js/web_socket.js?t=1513326254000"></script>
    <script type="text/javascript" src="js/websocket.js?t=1513326254000"></script>
    <script type="text/javascript" src="js/vue2.5.13.min.js"></script>
    <script type="text/javascript" src="js/axios0.18.0.min.js"></script>
    <script type="text/javascript" src="js/vue-resource.js"></script>
</head>

<body>
    <div id="bodys">
        <div id="header_top_notice"></div>
        <div id="jk-header">
            <div class="header">
                <h1>
                    <a href="index.html" class="logo">
                        <img src="img/logo.png?t=1513326254000" width="100" alt="骇客学院" />
                    </a>
                </h1>
                <nav style="width:490px;">
                    <ul>
                        <li>
                            <a href="index.html" class="home">首页</a>
                        </li>
                        <li class="careerpath">
                            <a href="javascript:void(0)">职业</a><i class="slide-icon"></i>
                            <div class="zhiye-submenu slide-submeu">
                            </div>
                        </li>
                        <li>
                            <a href="javascript:void(0)">课程</a><i class="slide-icon"></i>
                            <div class="slide-submeu">
                                <a href="javascript:void(0)">免费</a>
                                <a href="javascript:void(0)">VIP</a>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:void(0)">企业</a><i class="slide-icon"></i>
                            <div class="slide-submeu qy-box">
                            </div>
                        </li>
                        <li>
                            <a href="javascript:void(0)">社区</a><i class="slide-icon"></i>
                            <div class="slide-submeu">
                                <a href="javascript:void(0)">技术问答</a>
                            </div>

                        </li>
                    </ul>
                </nav>
                <div class="nav-other">
                    <div id="y-login">
                        <div class="centerbox" style="display: inline-block;">
                            <a href="ke_doing.html" class="learn-center" title="学习中心"></a>
                        </div>
                        <div class="centerbox" style="display: inline-block;">
                            <a href="" class="message" id="message" title="消息中心">
                                <i class="have" id="have" style="display: none;"></i>
                            </a>
                        </div>
                        <span class="userinfo-login" id="userinfo-login" style="display: inline-block;">
                            <a href="setting_user.html">
                                <img src="https://assets.jikexueyuan.com/user/avtar/default.gif" id="userpoto">
                            </a>
                            <i id="uservip-icon"></i>
                            <div class="slide-submeu user-slide">
                                <a href="ke_doing.html"><i class="learningcenter-icon"></i>学习中心</a>
                                <a href="learn_center.html"><i class="homepage-icon"></i>个人主页</a>
                                <a href="setting_user.html"><i class="set-icon"></i>账号设置</a>
                                <a href="user/logout?path=index"><i class="exit-icon"></i>退出登录</a>
                            </div>
                        </span>
                    </div>
                    <div id="n-login">
                        <span class="userinfo-notlogin">
                            <a href="Login.html">登录</a><i></i>
                            <a href="Register.html">注册</a>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="wrapper">
            <nav class="leftnav" id="leftNav">
                <ul>
                    <li><a href="setting_user.html">个人资料</a></li>
                    <li id="setting_ca">
                        <!--认证学员-->
                    </li>
                    <li><a href="setting_vip.html" class="">我的VIP</a></li>
                    <!--<li><a href="setting_pro.html" class="">我的Pro</a></li>
                <li><a href="setting_order.html" class="">我的订单</a></li>-->
                    <li><a href="setting_jkb.html" class="">我的极客币</a></li>
                    <!--<li><a href="setting_quan.html" class="">我的优惠券</a></li>-->
                    <li><a href="security.html" class="active">账号安全</a></li>
                    <li><a href="setting_message.html" class="">消息设置</a></li>
                    <!--<li><a href="setting_sns.html" class="">绑定第三方账号</a></li>-->
                </ul>
            </nav>
            <div class="main" id="main">
                <h2>账号安全</h2>
                <div class="security">
                    <ul>
                        <li>
                            <label>绑定手机</label>
                            <span id="phone"></span>
                            <a @click="setPhone()" href="javascript:;">修改手机号</a>
                        </li>
                        <li>
                            <label>绑定邮箱</label>
                            <span id="email">没有绑定</span>
                            <a @click="setEmail($event)" href="javascript:;">绑定邮箱</a>
                        </li>
                        <li>
                            <label>设置密码</label>
                            <span>******** <span class="ora"></span></span>
                            <!-- 没绑定邮箱或手机不显示设定密码 -->
                            <a @click="setPwd()" href="javascript:;">修改登录密码</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- 验证身份 -->
        <div class="popup" id="verify-pop" style="display: none;margin: 100px auto;z-index: 100px;top: 50px;left: 520px;">
            <div class="wrap">
                <div class="hd">
                    <h2>验证身份</h2>
                    <i class="close popclose" @click="closePopup($event)"></i>
                </div>
                <div class="bd">
                    <form class="form form-setting">
                        <p class="note">为了保证你的帐号安全，请验证身份。
                            <br />验证成功后进行下一步操作。</p>
                        <fieldset>
                            <div class="form-item">
                                <div class="item-cont w-lg">
                                    <select class="select w-lg" id="verifyType" name="" @change="changeVerify($event)">
                                        <option value="1">通过登录密码验证身份</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-item">
                                <div class="item-cont w-lg" id="verifyPwd">
                                    <input class="txt w-lg" id="ver-pwd" type="password" />
                                </div>
                                <div id="verifyOther">
                                    <div class="item-label">
                                        <label>验证码</label>
                                    </div>
                                    <div class="item-cont no-right">
                                        <input class="txt w-xs auth-code" id="ver-code" type='text' />
                                        <a href="javascript:;" class="get-code orange-btn" @click="sendMsg($event)">发送验证码</a>
                                    </div>
                                </div>
                            </div>
                            <div class="form-item">
                                <div class="item-cont">
                                    <input type="button" id="verifyBtn" @click="verifyBtn()" class="btn green-btn lg" value="验证身份" />
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
                <!-- /bd -->
            </div>
        </div>
        <!-- /设定初始密码 -->
        <!-- 修改密码 -->
        <div class="popup" style="width:360px; display: none;margin: 100px auto;z-index: 100px;top: 50px;left: 520px;" id="password-pop">
            <div class="wrap">
                <div class="hd">
                    <h2>修改密码</h2>
                    <i class="close popclose" @click="closePopup($event)"></i>
                </div>
                <div class="bd">
                    <form class="form form-setting">
                        <fieldset>
                            <div class="form-item">
                                <div class="item-label">
                                    <label>新密码</label>
                                </div>
                                <div class="item-cont">
                                    <input type="password" class="txt sm new-pw" id="newPwd" maxlength="32" />
                                    <div class="safety pwd-strong">
                                        <span class="level-1" level="1">弱</span>
                                        <span class="level-2" level="2">中</span>
                                        <span class="level-3" level="3">强</span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-item">
                                <div class="item-label">
                                    <label>确认密码</label>
                                </div>
                                <div class="item-cont no-right">
                                    <input type="password" class="txt sm repeat-pw" id="rePwd" maxlength="32" />
                                </div>
                            </div>
                            <div class="form-item">
                                <div class="item-cont">
                                    <input type="button" @click="editPwd()" class="btn green-btn lg changepw-btn" value="确认修改" />
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
        <!-- /修改密码 -->
        <!-- 绑定邮箱 -->
        <div class="popup" style="width: 360px; height: 242px; display: none;margin: 100px auto;z-index: 100px;top: 50px;left: 520px;" id="set-email">
            <div class="wrap">
                <div class="hd">
                    <h2>绑定邮箱</h2>
                    <i class="close popclose" @click="closePopup($event)"></i>
                </div>
                <div class="bd">
                    <form class="form form-setting h-auto">
                        <fieldset>
                            <div class="form-item">
                                <div class="item-label">
                                    <label>邮箱</label>
                                </div>
                                <div class="item-cont no-right">
                                    <input class="txt sm init-email" id="init_email" />
                                </div>
                            </div>
                            <div class="form-item">
                                <div class="item-cont">
                                    <input type="button" @click="bindEmail($event)" class="btn green-btn lg set-email-btn" value="确认绑定" />
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
        <!-- /绑定邮箱 -->
        <!-- 修改邮箱 -->
        <div class="popup" style="width: 360px; height: 242px;display: none;margin: 100px auto;z-index: 100px;top: 50px;left: 520px;" id="change-email">
            <div class="wrap">
                <div class="hd">
                    <h2>修改邮箱</h2>
                    <i class="close popclose" @click="closePopup($event)"></i>
                </div>
                <div class="bd">
                    <form class="form form-setting h-auto">
                        <fieldset>
                            <div class="form-item">
                                <div class="item-label">
                                    <label>邮箱</label>
                                </div>
                                <div class="item-cont no-right">
                                    <input class="txt sm new-email" id="set_email" />
                                </div>
                            </div>
                            <div class="form-item">
                                <div class="item-cont">
                                    <input type="button" @click="bindEmail($event)" class="btn green-btn lg change-email-btn" value="确认修改" />
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
        <!-- /绑定手机号 -->
        <!-- 修改手机号 -->
        <div class="popup" style="width: 360px; height: 301px; display: none;margin: 100px auto;z-index: 100px;top: 50px;left: 520px;" id="change-phone" data-state='alter'>
            <div class="wrap">
                <div class="hd">
                    <h2>修改手机号</h2>
                    <i class="close popclose" @click="closePopup($event)"></i>
                </div>
                <div class="bd">
                    <form class="form form-setting h-auto">
                        <fieldset>
                            <div class="form-item">
                                <div class="item-label">
                                    <label>新手机号</label>
                                </div>
                                <div class="item-cont no-right">
                                    <input class="txt sm new-phone phoneNum" id="phoneNum" />
                                </div>
                            </div>
                            <div class="form-item">
                                <div class="item-label">
                                    <label>验证码</label>
                                </div>
                                <div class="item-cont no-right">
                                    <input class="txt w-xs auth-code" type='text' id="newCode" />
                                    <a href="javascript:;" class="get-code orange-btn" @click="sendPhone()">发送验证码</a>
                                </div>
                            </div>
                            <div class="form-item">
                                <div class="item-cont">
                                    <input type="button" @click="changePhoneSubmit()" class="btn green-btn lg change-phone-btn" value="确认修改" />
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
        <!-- /修改手机号 -->
        <!-- /解除绑定2 -->

    </div>
</body>


<script>
    window.IS_SELF = 0;

</script>
<script src="js/jquery.min.js"></script>
<script src="js/popup.js"></script>
<!-- 绑定第三方JS -->
<script src="js/index.js"></script>
<script src="js/common.js"></script>
<link rel="stylesheet" href="css/footer.css?t=1513326254000" />
<div id="footer">
    <div class="footer-content">
        <div class="contact-way">
            <div class="other-way">
                <a href="//blog.jikexueyuan.com/28.html " target="_blank" class="weixin-icon"></a>
                <!--<a href="" class="tencen-icon"></a>-->
                <a href="//weibo.com/jikexueyuan" target="_blank" class="sina-icon"></a>
                <a href="//twitter.com/jikexueyuan" target="_blank" class="facebook-icon"></a>
                <a href="//plus.google.com/communities/117673330839635588089" target="_blank" class="google-icon"></a>
            </div>
        </div>
        <nav>
            <a href="javascript:" target="_blank">关于我们</a><i>|</i>
            <a href="javascript:" target="_blank">加入我们</a><i>|</i>
            <a href="javascript:" target="_blank">联系我们</a><i>|</i>
            <a href="javascript:" target="_blank">企业合作</a><i>|</i>
            <a href="apply.html" target="_blank">讲师合作</a><i>|</i>
            <a href="javascript:" target="_blank">帮助中心</a><i>|</i>
            <a href="javascript:" target="_blank">黑板报</a><i>|</i>
            <a href="javascript:" target="_blank">友情链接</a>
        </nav>
        <div class="copyright">Copyright © 2013-2018 jikexueyuan.com All Rights Reserved. 京ICP备11018032号 京公网安备11010802013056</div>
    </div>
    <div class="gotop" id="gototop">
        <span class="tel-icon">
            <div class="tel-number"></div>
        </span>
        <!-- <a class="service" href="javascript:void(0);" onclick="meiqia()"></a> -->
        <span class="wx">
            <div class="appewm"></div>
        </span>
        <span class="top"><i></i></span>
    </div>
</div>
<script type="text/javascript" src="js/login_register.min.js?t=1513326254000"></script>
<script type="text/javascript" src="js/vue2.5.13.min.js"></script>
<script type="text/javascript" src="js/axios0.18.0.min.js"></script>
<script type="text/javascript" src="js/vue-resource.js"></script>
<script type="text/javascript" src="js/myscript.js"></script>
<script>
    function gotop() {
        var html = $("#gototop");
        if ($(window).scrollTop() <= 0) {
            $("#gototop>.top>i").hide()
        }
        $("#gototop>.top").bind("click", function() {
            if ($(window).scrollTop() <= 0) {
                return false
            }
            $("body,html").animate({
                scrollTop: 0
            }, 200);
            return false
        });
        $(window).scroll(function() {
            if ($(window).scrollTop() > 0) {
                $("#gototop>.top>i").fadeIn()
            } else {
                $("#gototop>.top>i").fadeOut()
            }
        })
    }
    $(function() {
        gotop()
    });


    new Vue({
        el: '#bodys',
        data: {
            pwd: "",
            phone: "",
            msg: "",
            temp: ""
        },
        created: function() {
            this.showUser();
        },
        methods: { //弹出身份验证弹窗
            setPhone: function() {
                $("#verify-pop").show();
                this.temp = "#change-phone";
            }, //弹出添加/修改邮箱窗口
            setEmail: function(e) {
                if ($(e.target).prev().html() == "没有绑定") {
                    $("#set-email").show();
                } else {
                    $("#change-email").show();
                }
            }, //弹出身份验证窗口
            setPwd: function() {
                $("#verify-pop").show();
                this.temp = "#password-pop";
            }, //关闭各种窗口
            closePopup: function(obj) {
                $(obj.target).parent().parent().parent().hide();
                $("#verifyPwd").val("");
                $("#ver-code").val("");
                $("#phoneNum").val("");
                $("#newCode").val("");
            }, //页面初始化时，显示数据
            showUser: function() { //通过cookie查询用户是否处于登陆状态
                var url = "user/queryByUsers";
                var str = this.getCookie("phone");
                var formData = new FormData();
                formData.append("phone", str)
                if (str != "") {
                    this.$http.post(url, formData).then(function(response) {
                        //console.log("data:" + response.data.u_phone);
                        if (response.data.u_phone == str) {
                            $("#y-login").show(); //如果查询的用户账号与本地储存的值相等
                            $("#n-login").hide(); //则显示长在登录状态，否则显示离线状态
                            $("#userpoto").attr("src", response.data.u_photo);
                            var u_email = response.data.u_email;
                            if (null != u_email) {
                                $("#email").html(u_email.substr(0, 3) + "****" + u_email.substr(6));
                            }
                            this.pwd = response.data.u_pwd; //将用户密码放入全局变量
                            this.phone = str;
                            var phone2 = '通过手机号' + str.substr(0, 3) + "****" + str.substr(7) + '验证';
                            document.getElementById("verifyType").add(new Option(phone2, 2), null);
                            $("#phone").html(str.substr(0, 3) + "****" + str.substr(7));
                            //判断是否认证学院
                            if(response.data.u_stu_authentication != null){
                                $("#setting_ca").html("<a href='setting_ca.html' class=''>认证学员</a><i class='pro-icon''></i> <span></span>");
                            }else{
                                $("#setting_ca").html("<a href='setting_ca.html' class=''>认证学员</a><i class='nopro-icon' style='background-image: url(img/nopro.png);'></i> <span></span>");
                            }
                        } else {
                            $("#y-login").hide();
                            $("#n-login").show();
                        }
                    });
                } else {
                    $("#y-login").hide();
                    $("#n-login").show();
                }
            }, //通过本地cookie查询登录信息
            getCookie: function(key) {
                var arr1 = document.cookie.split("; ");
                for (var i = 0; i < arr1.length; i++) {
                    var arr2 = arr1[i].split("="); //通过=截断，把name=Jack截断成[name,Jack]数组;
                    if (arr2[0] == key) {
                        return decodeURI(arr2[1]);
                    }
                }
            }, //选择身份验证的方式
            changeVerify: function(e) {
                if ($(e.target).val() == 1) {
                    $("#verifyPwd").show();
                    $("#verifyOther").hide();
                    $("#verify-pop").css("width", "350px");
                } else {
                    $("#verifyPwd").hide();
                    $("#verifyOther").show();
                    $("#verify-pop").css("width", "420px");
                }
            }, //用手机验证码进行身份验证
            sendMsg: function(e) {
                var formData = new FormData();
                formData.append("phone", this.phone);
                this.$http.post("user/getMsg", formData).then(function(response) {
                    this.msg = response.bodyText;
                })
            }, //判断是修改手机号还是修改密码操作
            verifyBtn: function() {
                if ($("#verifyType").val() == 1) {
                    if (this.pwd == $("#ver-pwd").val()) { //用密码进行身份验证
                        $("#verify-pop").hide();
                        $(this.temp).show();
                    } else {
                        this.showMsg("输入的密码不对");
                    }
                } else {
                    if (this.msg == $("#ver-code").val()) {
                        $("#verify-pop").hide();
                        $(this.temp).show();
                    } else {
                        this.showMsg("输入的验证码不对");
                    }
                }
            }, //修改用户手机号前给用户手机发送验证码用来确认
            sendPhone: function() {
                if ($("#phoneNum").val() != "") {
                    if ($("#phoneNum").val() == this.phone) {
                        this.showMsg("不能输入正在绑定的手机号");
                        return;
                    }
                    var formData = new FormData();
                    formData.append("phone", $("#phoneNum").val());
                    this.$http.post("user/getMsg", formData).then(function(response) {
                        this.msg = response.bodyText;
                        console.log(response);
                    })
                } else {
                    this.showMsg("请输入新手机号");
                }
            }, //修改用户手机号
            changePhoneSubmit: function() {
                if (this.msg == $("#newCode").val()) {
                    var formData = new FormData();
                    formData.append("newPhone", $("#phoneNum").val());
                    formData.append("phone", this.phone);
                    this.$http.post("user/editPhone", formData).then(function(response) {
                        if (response.data == 1) {
                            this.setCookie("phone", $("#phoneNum").val(), 7);
                            window.location.reload();
                        }
                    })
                } else {
                    this.showMsg("输入的验证码不正确！");
                }
            }, //绑定/修改邮箱
            bindEmail: function(e) {
                var u_emails = "";
                if ($(e.target).val() == "确认绑定") {
                    u_emails = $("#init_email").val();
                } else {
                    u_emails = $("#set_email").val();
                }
                if (u_emails == "") {
                    this.showMsg("请输入正确的邮箱");
                    return;
                }
                var formData = new FormData();
                formData.append("u_email", u_emails);
                formData.append("phone", this.phone);
                this.$http.post("user/editEmail", formData).then(function(response) {
                    if (response.data == 1) {
                        window.location.reload();
                    }
                })
            }, //修改密码
            editPwd: function() {
                if ($("#newPwd").val() != "") {
                    if ($("#rePwd").val() != "") {
                        if ($("#newPwd").val() == $("#rePwd").val()) {
                            var formData = new FormData();
                            formData.append("u_pwd", $("#newPwd").val());
                            formData.append("phone", this.phone);
                            this.$http.post("user/editPwd", formData).then(function(response) {
                                if (response.data == 1) {
                                    window.location.reload();
                                }
                            })
                        } else {
                            this.showMsg("密码不一致");
                        }
                    } else {
                        this.showMsg("请输入确认密码");
                    }
                } else {
                    this.showMsg("请输入新密码");
                }
            },
            setCookie: function(key, value, t) {
                if (t > 0) {
                    var oDate = new Date();
                    oDate.setDate(oDate.getDate() + t);
                    document.cookie = key + "=" + value + "; expires=" + oDate.toDateString();
                }
            },
            showMsg: function(text) {
                $("body").append("<div id='successMsg' class='successMsg'>" + text + "</div>");
                $(".successMsg").css('margin', '100px auto');
                $(".successMsg").css('display', 'none');
                $(".successMsg").css('color', '#FFFFFF');
                $(".successMsg").css('text-align', 'center');
                $(".successMsg").css('position', 'fixed');
                $(".successMsg").css('left', '60px');
                $(".successMsg").css('top', '0px');
                $(".successMsg").css('margin-left', '40%');
                $(".successMsg").css('background-color', '#32B657');
                $(".successMsg").css('font-size', '20px');
                $(".successMsg").css('z-index', '9999');
                $(".successMsg").css('border-radius', '5px');
                $(".successMsg").css('line-height', '40px');
                $(".successMsg").css('padding', '10px');
                $("#successMsg").show().delay(1000).fadeOut(900);
            }
        }
    });

</script>
<script type="text/javascript" src="js/meiqia.js?t=1513326254000"></script>

</html>
