<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <title>骇客学院</title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <title>我的VIP</title>
    <link rel="stylesheet" type="text/css" href="css/index.min.css">
    <script type="text/javascript" src="js/growingio.js?t=1513326254000"></script>
    <script type="text/javascript" src="js/mask.js?t=1513326254000"></script>
    <script type="text/javascript" src="js/jquery.min.js?t=1513326254000"></script>
    <script type="text/javascript" src="js/header.min.js?t=1544581681296"></script>
    <script type="text/javascript" src="js/web_socket.js?t=1513326254000"></script>
    <script type="text/javascript" src="js/websocket.js?t=1513326254000"></script>
    <script type="text/javascript" src="js/vue2.5.13.min.js"></script>
    <script type="text/javascript" src="js/axios0.18.0.min.js"></script>
    <script type="text/javascript" src="js/vue-resource.js"></script>
</head>

<body>
	<div id="firsts">
    <div id="header_top_notice"></div>
    <div id="jk-header">
        <div class="header">
            <h1>
                <a href="index.html" class="logo">
                    <img src="img/logo.png?t=1513326254000" width="100" alt="骇客学院" />
                </a>
            </h1>
            <nav style="width:490px;">
                <ul>
                        <li>
                            <a href="index.html" class="home">首页</a>
                        </li>
                        <li class="careerpath">
                            <a href="">VIP</a>
                        </li>
                        <li>
                            <a href="">免费</a>
                        </li>
                        <li>
                            <a href="art.html" target="_blank">技术问答</a>
                        </li>
                    </ul>
            </nav>
            <div class="nav-other">
                <div id="y-login">
                    <div class="centerbox" style="display: inline-block;">
                        <a href="ke_doing.html" class="learn-center" title="学习中心"></a>
                    </div>
                    <div class="centerbox" style="display: inline-block;">
                        <a href="" class="message" id="message" title="消息中心">
                            <i class="have" id="have" style="display: none;"></i>
                        </a>
                    </div>
                    <span class="userinfo-login" id="userinfo-login" style="display: inline-block;">
                        <a href="setting_user.html">
                            <img src="https://assets.jikexueyuan.com/user/avtar/default.gif" id="userpoto">
                        </a>
                        <i id="uservip-icon"></i>
                        <div class="slide-submeu user-slide">
                            <a href="ke_doing.html"><i class="learningcenter-icon"></i>学习中心</a>
                            <a href="learn_center.html"><i class="homepage-icon"></i>个人主页</a>
                            <a href="setting_user.html"><i class="set-icon"></i>账号设置</a>
                            <a href="user/logout?path=index"><i class="exit-icon"></i>退出登录</a>
                        </div>
                    </span>
                </div>
                <div id="n-login">
                    <span class="userinfo-notlogin">
                        <a href="Login.html">登录</a><i></i>
                        <a href="Register.html">注册</a>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="wrapper">
        <nav class="leftnav" id="leftNav">
            <ul>
                <li><a href="setting_user.html" class="">个人资料</a></li>
                <li id="setting_ca">
                    <!--认证学员-->
                </li>
                <li><a href="setting_vip.html" class="active">我的VIP</a></li>
                <!--<li><a href="setting_pro.html" class="">我的Pro</a></li>
                <li><a href="setting_order.html" class="">我的订单</a></li>-->
                <li><a href="setting_jkb.html" class="">我的骇客币</a></li>
                <!--<li><a href="setting_quan.html" class="">我的优惠券</a></li>-->
                <li><a href="security.html" class="">账号安全</a></li>
                <li><a href="setting_message.html" class="">消息设置</a></li>
                <!--<li><a href="setting_sns.html" class="">绑定第三方账号</a></li>-->
            </ul>
        </nav>
        <div class="main">
            <h2>我的VIP</h2>
            <section class="vip">
                <div class="statusvip">
                    <div class="statusvip-content">
                    	<h3 id="h1" style="display: none;">尊敬的会员 </h3>
                        <h3 id="h2" style="display: none;">您尚无VIP会员资格 </h3>
                        <h3 id="h3" style="display: none;">VIP会员资格已到期</h3>
                        <a href="vip.html" id="a1" class="green-btn" style="display: none;">购买</a>
                        <div class="statusvip-bar">
                            <div class="statusvip-bar-now" id="d1" style="width:0%"></div>
                        </div>
                    </div>
                    <aside class="statusvip-aside">
                        <h3>剩余：{{ times }}天</h3>
                    </aside>
                </div>
            </section>
        </div>
    </div>
</div>
</body>


<script>
    window.IS_SELF = 0;

</script>
<script src="js/index.js"></script>
<script src="js/common.js"></script>
<link rel="stylesheet" href="css/footer.css?t=1513326254000" />
<div id="footer" style="margin-top: 0px;">
    <div class="footer-content">
        <div class="contact-way">
            <div class="other-way">
                <a href="//blog.jikexueyuan.com/28.html " target="_blank" class="weixin-icon"></a>
                <!--<a href="" class="tencen-icon"></a>-->
                <a href="//weibo.com/jikexueyuan" target="_blank" class="sina-icon"></a>
                <a href="//twitter.com/jikexueyuan" target="_blank" class="facebook-icon"></a>
                <a href="//plus.google.com/communities/117673330839635588089" target="_blank" class="google-icon"></a>
            </div>
        </div>
        <nav>
            <a href="javascript:" target="_blank">关于我们</a><i>|</i>
            <a href="javascript:" target="_blank">加入我们</a><i>|</i>
            <a href="javascript:" target="_blank">联系我们</a><i>|</i>
            <a href="javascript:" target="_blank">企业合作</a><i>|</i>
            <a href="apply.html" target="_blank">讲师合作</a><i>|</i>
            <a href="javascript:" target="_blank">帮助中心</a><i>|</i>
            <a href="javascript:" target="_blank">黑板报</a><i>|</i>
            <a href="javascript:" target="_blank">友情链接</a>
        </nav>
        <div class="copyright">Copyright © 2013-2018 jikexueyuan.com All Rights Reserved. 京ICP备11018032号 京公网安备11010802013056</div>
    </div>
    <div class="gotop" id="gototop">
        <span class="tel-icon">
            <div class="tel-number"></div>
        </span>
        <!-- <a class="service" href="javascript:void(0);" onclick="meiqia()"></a> -->
        <span class="wx">
            <div class="appewm"></div>
        </span>
        <span class="top"><i></i></span>
    </div>
</div>
<script type="text/javascript" src="js/login_register.min.js?t=1513326254000"></script>
<script>
    function gotop() {
        var html = $("#gototop");
        if ($(window).scrollTop() <= 0) {
            $("#gototop>.top>i").hide()
        }
        $("#gototop>.top").bind("click", function() {
            if ($(window).scrollTop() <= 0) {
                return false
            }
            $("body,html").animate({
                scrollTop: 0
            }, 200);
            return false
        });
        $(window).scroll(function() {
            if ($(window).scrollTop() > 0) {
                $("#gototop>.top>i").fadeIn()
            } else {
                $("#gototop>.top>i").fadeOut()
            }
        })
    }
    $(function() {
        gotop()
    });

</script>
<script type="text/javascript" src="js/meiqia.js?t=1513326254000"></script>
<script>
    new Vue({
        el: '#firsts',
        data: {
			times : ""
        },
        created: function() {
            this.showUser();
        },
        methods: {
            showUser: function() { //通过cookie查询用户是否处于登陆状态
            	if(this.getCookie("phone") == null){
                	window.location.href = "index.html";
                }
                var url = "user/queryByUsers";
                var str = this.getCookie("phone");
                var formData = new FormData();
                formData.append("phone", str);
                if (str != "") {
                    this.$http.post(url, formData).then(function(response) {
                        //console.log("data:" + response.data.u_phone);
                    	if (response.data.u_phone == undefined || response.data.u_phone == ""){
                        	$("#y-login").hide();
                            $("#n-login").show();
                        }else if (response.data.u_phone == str) {
                            $("#y-login").show(); //如果查询的用户账号与本地储存的值相等
                            $("#n-login").hide(); //则显示长在登录状态，否则显示离线状态
                            $("#userpoto").attr("src", response.data.u_photo);
                            console.log(new Date() + " ," + response.data.u_vip_enddate);
                            this.times = this.getDate(response.data.u_vip_date,response.data.u_vip_enddate) - this.getDate(response.data.u_vip_date,new Date());
                            if(this.times < 0){
                            	this.times = 0;
                            	$.ajax({
                            		url:'user/updVip_ById',
                            		data:{"u_id":response.data.u_id},
                            		type:'post',
                            		dataType:'json',
                            		success:function(data){
                            			console.log(data);
                            		}
                            	});
                            }
                            var sdate = this.getDate(response.data.u_vip_date,response.data.u_vip_enddate);
                            var scv = this.times / sdate * 100;
                            console.log(sdate);
                            console.log(scv);
                            if(response.data.u_vip_enddate != null){
                            	if(this.times < 1){
                            		$("#h3").css("display","block");
                            		$("#h2").css("display","none");
                            		$("#h1").css("display","none");
                            		$("#a1").css("display","block");
                            	}else{
                            		$("#h1").css("display","block");
                            		$("#h3").css("display","none");
                            		$("#h2").css("display","none");
                            		$("#a1").css("display","none");
                            	}
                            	$("#d1").css("width",scv + "%");
                            }else{
                            	$("#h1").css("display","none");
                        		$("#h3").css("display","none");
                        		$("#h2").css("display","block");
                        		$("#a1").css("display","block");
                        		this.times = 0;
                            }
                            //判断是否认证学院
                            if(response.data.u_stu_authentication != null){
                                $("#setting_ca").html("<a href='setting_ca.html' class=''>认证学员</a><i class='pro-icon'></i> <span></span>");
                            }else{
                                $("#setting_ca").html("<a href='setting_ca.html' class=''>认证学员</a><i class='nopro-icon'></i> <span></span>");
                            }
                        } else {
                            $("#y-login").hide();
                            $("#n-login").show();
                        }
                    });
                } else {
                    $("#y-login").hide();
                    $("#n-login").show();
                }     		
            },
            getCookie: function(key) {
                var arr1 = document.cookie.split("; ");
                for (var i = 0; i < arr1.length; i++) {
                    var arr2 = arr1[i].split("="); //通过=截断，把name=Jack截断成[name,Jack]数组;
                    if (arr2[0] == key) {
                        return decodeURI(arr2[1]);
                    }
                }
            },
            getDate: function(minTime,MaxTime){
            	var xyear = Date.parse(MaxTime);
                var dyear = Date.parse(minTime);
                var time = xyear - dyear;
                time = Math.abs(time);
                var iDays = Math.floor(time / (24 * 3600 * 1000));
                return iDays;
            }
        }
    })

</script>

</html>
